# ğŸ§  Raspberry Pi Pico + micro-ROS + RFID Reader (MFRC522) íŠœí† ë¦¬ì–¼

## ğŸ§© micro-ROS í†µì‹  êµ¬ì¡°
```css
[Pico] <â€”â€”serialâ€”â€”> [micro-ROS Agent] <â€”â€”DDSâ€”â€”> [ROS 2 (ìŠ¤ì¹´ìš°íŠ¸ ë¯¸ë‹ˆ)]
```

| êµ¬ì„± ìš”ì†Œ                 | ì—­í•                                            | ìœ„ì¹˜                       |
| --------------------- | -------------------------------------------- | ------------------------ |
| **Raspberry Pi Pico** | `micro-ROS client` (Publisher/Subscriber ë™ì‘) | Pico                     |
| **micro-ROS Agent**   | Pico â†” ROS 2 ì‚¬ì´ì˜ **ë¸Œë¦¬ì§€(bridge)** ì—­í•           | **í˜¸ìŠ¤íŠ¸ ì¸¡(ìŠ¤ì¹´ìš°íŠ¸ ë¯¸ë‹ˆ or PC)** |
| **ROS 2 System**      | í† í”½, ì„œë¹„ìŠ¤, ì•¡ì…˜ ê´€ë¦¬ (DDS ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬)                 | **ìŠ¤ì¹´ìš°íŠ¸ ë¯¸ë‹ˆ**              |


## âš™ï¸ íŠœí† ë¦¬ì–¼

### 1. í™˜ê²½ ì¤€ë¹„
**âœ… í•„ìˆ˜ í•­ëª©**
- Raspberry Pi Pico
- Ubuntu PC (ROS 2 í™˜ê²½ í¬í•¨)
- USB ì¼€ì´ë¸” (ë°ì´í„° ì „ì†¡ìš©)
- MFRC522 RFID ëª¨ë“ˆ, LED
- ì í¼ ì¼€ì´ë¸”

### âš™ï¸ 2. í•€ ì—°ê²° (Pico â†” MFRC522)

| MFRC522 í•€ | Pico í•€ | ì„¤ëª… |
|-------------|----------|------|
| VCC | 3.3V | ì „ì› |
| GND | GND | ê·¸ë¼ìš´ë“œ |
| RST | GP0 | Reset í•€ |
| SDA (SS) | GP1 | SPI CS |
| MOSI | GP3 | SPI MOSI |
| MISO | GP4 | SPI MISO |
| SCK | GP2 | SPI CLK |

> [Pico RFID íšŒë¡œë„ ì°¸ê³ ](https://www.tomshardware.com/raspberry-pi/raspberry-pi-pico/how-to-use-an-rfid-reader-with-a-raspberry-pi-pico)
> 
> ğŸ’¡ MFRC522ëŠ” 3.3V ì „ì›ë§Œ ì§€ì› (5V ì—°ê²° ê¸ˆì§€)

<br>

### ğŸ§± 3.ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„±ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Raspberry Pi Pico (MCU)    â”‚
â”‚                            â”‚
â”‚ [MFRC522] â†’ RFID UID       â”‚
â”‚ â†“                          â”‚
â”‚ micro-ROS Client (UART)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Serial (UART)
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Raspberry Pi 4 (Host)      â”‚
â”‚                            â”‚
â”‚ micro-ROS Agent â†” ROS 2    â”‚
â”‚ Topic: /rfid_detected      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ§© 4. Pico ìª½ ì„¤ì • (micro-ROS íŒì›¨ì–´ ë¹Œë“œ)

- **micro_ros_raspberrypi_pico github** : [ë§í¬](https://github.com/micro-ROS/micro_ros_raspberrypi_pico_sdk/tree/humble)
- **raspberry pi pico and RFID ì°¸ê³ **: [RFID-ESP32S3-MicroRos](https://github.com/Chinmay-ESP/RFID-ESP32S3-MicroRos/tree/main), [pico-mfrc522](https://github.com/BenjaminModica/pico-mfrc522)

<br>

### ğŸ§© 5. Picoìš© RFID + micro-ROS ì½”ë“œ ì˜ˆì œ
`example_rfid.c` ë‚´ìš© ì˜ˆì‹œ:

<details>
<summary>ë‚´ìš©ë³´ê¸° ğŸ”½</summary>

```
#include <stdio.h>
#include "pico/stdlib.h"
#include "hardware/spi.h"
#include "MFRC522.h"
#include <rcl/rcl.h>
#include <rclc/rclc.h>
#include <rclc/executor.h>
#include <std_msgs/msg/string.h>

#define SPI_PORT spi0
#define PIN_MISO 4
#define PIN_CS   1
#define PIN_SCK  2
#define PIN_MOSI 3
#define PIN_RST  0

MFRC522 rfid(PIN_CS, PIN_RST);

rcl_publisher_t publisher;
std_msgs__msg__String msg;

void setup_rfid() {
    spi_init(SPI_PORT, 1000 * 1000);
    gpio_set_function(PIN_MISO, GPIO_FUNC_SPI);
    gpio_set_function(PIN_CS, GPIO_FUNC_SIO);
    gpio_set_function(PIN_SCK, GPIO_FUNC_SPI);
    gpio_set_function(PIN_MOSI, GPIO_FUNC_SPI);
    rfid.PCD_Init();
}

int main() {
    stdio_init_all();
    setup_rfid();

    rcl_allocator_t allocator = rcl_get_default_allocator();
    rclc_support_t support;
    rclc_support_init(&support, 0, NULL, &allocator);

    rcl_node_t node;
    rclc_node_init_default(&node, "rfid_pico_node", "", &support);
    rclc_publisher_init_default(
        &publisher,
        &node,
        ROSIDL_GET_MSG_TYPE_SUPPORT(std_msgs, msg, String),
        "rfid_detected");

    msg.data.data = (char*)malloc(32);
    msg.data.capacity = 32;

    while (true) {
        if (rfid.PICC_IsNewCardPresent() && rfid.PICC_ReadCardSerial()) {
            sprintf(msg.data.data, "UID: %02X%02X%02X%02X",
                    rfid.uid.uidByte[0],
                    rfid.uid.uidByte[1],
                    rfid.uid.uidByte[2],
                    rfid.uid.uidByte[3]);
            msg.data.size = strlen(msg.data.data);
            rcl_publish(&publisher, &msg, NULL);
            printf("Published: %s\n", msg.data.data);
            sleep_ms(1000);
        }
    }

    return 0;
}

```

</details>


### âš¡ 6. ë¹Œë“œ ë° íŒì›¨ì–´ í”Œë˜ì‹±

1. ë¹Œë“œ
```bash
cd ~/micro_ros_raspberrypi_pico_sdk
mkdir build && cd build
cmake ..
make

```
2. Picoë¥¼ **BOOTSEL ë²„íŠ¼ ëˆ„ë¥¸ ìƒíƒœë¡œ PC ì—°ê²°**
3. ìƒˆë¡œ ëœ¬ ë“œë¼ì´ë¸Œì— .uf2 íŒŒì¼ ë³µì‚¬ â†’ ìë™ ì¬ë¶€íŒ…

### ğŸŒ‰ 7. ë¼ì¦ˆë² ë¦¬íŒŒì´ (Host)ì—ì„œ micro-ROS Agent ì‹¤í–‰
Picoê°€ `/dev/ttyACM0`ë¡œ ì¸ì‹ë˜ì–´ ìˆë‹¤ë©´ ë‹¤ìŒ ì‹¤í–‰:
```
# micro-ROS ì—ì´ì „íŠ¸ ì„¤ì¹˜
sudo apt install ros-humble-micro-ros-agent

# micro-ROS Agent ì‹¤í–‰
sudo docker run -it --rm --net=host --privileged \
  -v /dev:/dev microros/micro-ros-agent:humble \
  serial --dev /dev/ttyACM0 -v6

```

### ğŸ§¾ 8. ROS 2 í† í”½ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸

```bash
ros2 topic echo /rfid_detected

```

---

#### Raspberry Pi Pico + micro-ROS RFID íƒœê·¸ ì¸ì‹ í™œìš© ì•„ì´ë””ì–´
- ë¡œë´‡ ì¶œì… ì œì–´ ì‹œìŠ¤í…œ
- ìë™ ë°©ë¬¸ì ì¸ì‹
- ë¡œë´‡ ë¬¼í’ˆ ì¸ì‹ ë¡œì§

